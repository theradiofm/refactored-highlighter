/*!
 * Thorium Core functions for framework7 projects
 * Version 3.1 July, 2021
 * framework7 v5.x (https://framework7.io) MIT Licensed
 * Copyright 2018-2021 Thorium builder, All Rights Reserved.
*/
String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},String.prototype.escapeSpecialChars=function(){return this.replace(/[\\]/g,"\\\\").replace(/[\/]/g,"\\/").replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t").replace(/[\"]/g,'\\"').replace(/\\'/g,"\\'")};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,o,r,a,n,l,u="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)r=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(i=e.charCodeAt(c++))>>4,n=(15&i)<<2|(o=e.charCodeAt(c++))>>6,l=63&o,isNaN(i)?n=l=64:isNaN(o)&&(l=64),u=u+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(n)+this._keyStr.charAt(l);return u},decode:function(e){var t,i,o,r,a,n,l="",u=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");u<e.length;)t=this._keyStr.indexOf(e.charAt(u++))<<2|(r=this._keyStr.indexOf(e.charAt(u++)))>>4,i=(15&r)<<4|(a=this._keyStr.indexOf(e.charAt(u++)))>>2,o=(3&a)<<6|(n=this._keyStr.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!=a&&(l+=String.fromCharCode(i)),64!=n&&(l+=String.fromCharCode(o));return l=Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",i=0,o=c1=c2=0;i<e.length;)(o=e.charCodeAt(i))<128?(t+=String.fromCharCode(o),i++):o>191&&o<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&o)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),i+=3);return t}},thoriumapi={name:"Thorium Public API",bundleid:"com.thoriumbuilder.api",version:"3.0.0",isLocal:function(){return"file:"==window.location.protocol},handleError:function(e,t,i,o){var r=window.location.pathname,a=r.substring(0,r.lastIndexOf("/")),n=window.location.origin,l='<span class="text-color-red">[javascript error]</span><br><span class="text-color-blue">'+e+'</span><br>source: <span class="text-color-blue">'+(t=t.replace("file://","").replace(a,"").replace("/js/","").replace(n,""))+"</span><br>[line: "+i+" - col: "+o+"]";kDebugMessagesLevel,app.preloader.hide,2==kDebugMessagesLevel&&app.dialog.alert(l,"Debugger"),kDebugMessagesLevel>0&&thoriumapi.logEvent(2,"[com.thoriumbuilder.core] "+e)},logEvent:function(e,t){if(kDebugMessagesLevel>0){e=e||0,t=t||"";var i=new Date;i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds();if(window.status="{"+e+"} "+t,0==app.device.capacitor)window.webkit&&0==app.device.cordova&&0==app.device.capacitor&&window.webkit.messageHandlers.thoriumHandler.postMessage("{"+e+"} "+t)}},loadpage:function(e,t,i){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Loading page "+e),i?app.view[0].router.navigate("/"+e+"/?data="+t,{animate:!0,transition:i,reloadAll:!1}):app.view[0].router.navigate("/"+e+"/?data="+t,{animate:!0,reloadAll:!1})},alert:function(e){"undefined"!=typeof app?($(".apploader").hide(),app.preloader.hide(),app.dialog.alert(e,"")):alert(e)},logError:function(e,t){$(".apploader").hide(),auth&&thoriumapi.logEvent(2,"["+auth.bundleid+"] "+t),1==e&&(app.preloader.hide(),app.dialog.alert(t,"Alert"))},status:function(e){return e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(new Error(e.statusText))},json:function(e){return e.json()},checkResult:function(e){return e&&e.code<0?(app.preloader.hide(),app.dialog.alert(e.message),!1):!!e||(app.preloader.hide(),app.dialog.alert("Invalid Result"),!1)},getpageparam:function(e){var t=e.detail.route;if(t)return t.query.data||null},reloadHomePage:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Reloading Home Page "),"/"!=app.view[0].router.url&&(app.preloader.show(),setTimeout((function(){location.reload()}),1e3))},backToPreviousPage:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Back to previous page"),app.view[0].router.back()},txtToUrl:function(e){if(null==e)return"";var t=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);try{var i=e.match(t)}catch(t){return e}return i?(i.forEach((function(t){e=e.replace(t,'<a class="link external" data-rel="external" target="_blank" rel="noopener" href="'+t+'">'+i+"</a>")})),e):e},isSafari:function(){var e=navigator.userAgent.toLowerCase();if(-1!=e.indexOf("safari"))return!(e.indexOf("chrome")>-1)},showAlert:function(e){app.dialog.alert(thoriumCorePlugin.txtToUrl(e))},showNotification:function(e,t,i,o,r){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Notification"),t=t||3e3,i=i||"bell_fill",r=r||"",app.notification.create({icon:'<i class="f7-icons text-muted">'+i+"</i>",title:"NOTIFICATION",closeButton:!1,titleRightText:"",subtitle:r,text:e,closeTimeout:t,swipeToClose:!0,cssClass:o}).open()},showToast:function(e,t,i,o,r){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Showing Toast Message"),"boolean"!=typeof t&&(t=!1),i=i||"bottom",o=o||3e3,((r=r||null)?app.toast.create({icon:r?'<i class="f7-icons">'+r+"</i>":null,text:e,position:i,destroyOnClose:!0,closeTimeout:o}):app.toast.create({text:e,closeButton:t,closeButtonText:"OK",closeButtonColor:"text-color-white",position:i,destroyOnClose:!0,closeTimeout:o})).open()},openPopup:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Open Popup"),app.popup.create({content:e}).open()},getObjectViewPortPercent:function(e,t){var i=$("#"+e.id),o=i.offset().top,r=o+i.outerHeight(),a=t+$(window).height();Math.round(100*(r-$(window).scrollTop())/($(window).height()+i.height()));return parseInt(Math.round((a-o)/i.outerHeight()*100))},findGetParameter:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Get URL Parameters");var t=null,i=[];return location.search.substr(1).split("&").forEach((function(o){(i=o.split("="))[0]===e&&(t=decodeURIComponent(i[1]))})),t},localstorage:{name:"Thorium localstorage Public API",isAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage not available #"+e.code+" "+e.message),app.dialog.alert("Local Storage error #"+e.code+" "+e.message),!1}},setItem:function(e,t){if(1==thoriumapi.localstorage.isAvailable()){try{window.localStorage.setItem(e,t)}catch(e){return 22==e.code||1014==e.code&&"NS_ERROR_DOM_QUOTA_REACHED"===e.name?thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage is Full"):thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage error #"+e.code+" "+e.message),app.dialog.alert("Local Storage error #"+e.code+" "+e.message),!1}return!0}},getItem:function(e){if(1==thoriumapi.localstorage.isAvailable()){try{var t=window.localStorage.getItem(e)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage error #"+e.code+" "+e.message),void app.dialog.alert("Local Storage error #"+e.code+" "+e.message)}return t}},removeItem:function(e){if(1==thoriumapi.localstorage.isAvailable()){try{window.localStorage.removeItem(e)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage error #"+e.code+" "+e.message),app.dialog.alert("Local Storage error #"+e.code+" "+e.message),!1}return!0}},clear:function(){if(1==thoriumapi.localstorage.isAvailable()){try{window.localStorage.clear()}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Local Storage error #"+e.code+" "+e.message),app.dialog.alert("Local Storage error #"+e.code+" "+e.message),!1}return!0}}},sessionstorage:{name:"Thorium sessionstorage Public API",isAvailable:function(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage not available #"+e.code+" "+e.message),app.dialog.alert("Session Storage error #"+e.code+" "+e.message),!1}},setItem:function(e,t){if(1==thoriumapi.sessionstorage.isAvailable()){try{window.sessionStorage.setItem(e,t)}catch(e){return 22==e.code||1014==e.code&&"NS_ERROR_DOM_QUOTA_REACHED"===e.name?thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage is Full"):thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage error #"+e.code+" "+e.message),app.dialog.alert("Session Storage error #"+e.code+" "+e.message),!1}return!0}},getItem:function(e){if(1==thoriumapi.sessionstorage.isAvailable()){try{var t=window.sessionStorage.getItem(e)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage error #"+e.code+" "+e.message),void app.dialog.alert("Session Storage error #"+e.code+" "+e.message)}return t}},removeItem:function(e){if(1==thoriumapi.sessionstorage.isAvailable()){try{window.sessionStorage.removeItem(e)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage error #"+e.code+" "+e.message),app.dialog.alert("Session Storage error #"+e.code+" "+e.message),!1}return!0}},clear:function(){if(1==thoriumapi.sessionstorage.isAvailable()){try{window.sessionStorage.clear()}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Session Storage error #"+e.code+" "+e.message),app.dialog.alert("Session Storage error #"+e.code+" "+e.message),!1}return!0}}},geolocation:{name:"Thorium geolocation Public API",watch:null,latitude:null,longitude:null,accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,speed:null,timestamp:null,isAvailable:function(){return!!navigator.geolocation||(app.emit("geolocationError",error),thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Geolocation is not supported"),app.dialog.alert("Geolocation is not supported"),!1)},setPosition:function(e){if(e&&e.coords){var t=e.coords;thoriumapi.geolocation.latitude=t.latitude,thoriumapi.geolocation.longitude=t.longitude,thoriumapi.geolocation.accuracy=t.accuracy,thoriumapi.geolocation.altitude=t.altitude,thoriumapi.geolocation.altitudeAccuracy=t.altitudeAccuracy,thoriumapi.geolocation.heading=t.heading,thoriumapi.geolocation.speed=t.speed,thoriumapi.geolocation.timestamp=e.timestamp,thoriumapi.logEvent(0,"[com.thoriumbuilder.thoriumapi] geoLocation returned, ["+t.longitude+" | "+t.latitude+"]"),app.emit("geolocationSuccess",t)}},getCurrentPosition:function(){if(1==thoriumapi.geolocation.isAvailable()){thoriumapi.logEvent(0,"[com.thoriumbuilder.thoriumapi] Getting geoLocation...");try{navigator.geolocation.getCurrentPosition(thoriumapi.geolocation.setPosition,thoriumapi.geolocation.geoLocationError)}catch(e){return app.emit("geolocationError",e),thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] "+e.message),app.dialog.alert(e.message),!1}return!0}return!1},geoLocationError:function(e){app.emit("geolocationError",e),thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] "+e.message)},watchPosition:function(){watch=navigator.geolocation.watchPosition(thoriumapi.geolocation.setPosition,thoriumapi.geolocation.geoLocationError)},clearWatch:function(){thoriumapi.geolocation.watch&&(navigator.geolocation.clearWatch(thoriumapi.geolocation.watch),thoriumapi.geolocation.watch=null)}},mediaDevices:{name:"Thorium mediaDevices Public API",devices:[],enumerateDevices:function(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] enumerateDevices() not supported."),thoriumapi.mediaDevices.devices=[],void app.emit("mediaDevicesError","enumerateDevices() not supported.");navigator.mediaDevices.enumerateDevices().then((function(e){thoriumapi.mediaDevices.devices=[],e.forEach((function(e){thoriumapi.mediaDevices.devices.push(e),thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Device Added to list ["+thoriumapi.mediaDevices.devices.kind+" "+thoriumapi.mediaDevices.devices.label+"]")})),app.emit("mediaDevicesSuccess")})).catch((function(e){app.emit("mediaDevicesError",e.message)}))}},osm:{name:"Thorium Open Street Map - leaflet.js Public API",getMapInstance:function(e){if("undefined"!=typeof openStreetMapPlugin){var t=document.getElementById(e);return t&&t.data?t.data:null}thoriumapi.logEvent(2,"[com.thoriumbuilder.thoriumapi] Open Street Map & Leaflet Plugin not installed")}},repeaters:{name:"Thorium Repeaters Public API",getVirtualList:function(e){var t=document.getElementById(e);if(t){var i=t.querySelector(".virtual-list");if(i){var o=app.virtualList.get(i);return o||(o=app.virtualList.create(i)),o}}},getAllItems:function(e){var t=thoriumapi.repeaters.getVirtualList(e);return t?t.items:null},getItemAt:function(e,t){var i=thoriumapi.repeaters.getVirtualList(e);if(i)return i.items[t]},getFilteredItems:function(e){var t=thoriumapi.repeaters.getVirtualList(e);return t?t.filteredItems:null},clear:function(e){var t=thoriumapi.repeaters.getVirtualList(e);t&&(t.items=[],t.deleteAllItems(),t.update())},appendItem:function(e,t){var i=thoriumapi.repeaters.getVirtualList(e);i&&(i.items?t.dataindex=i.items.length:t.dataindex=0,i.appendItem(t),i.update())},replaceItemAt:function(e,t,i){var o=thoriumapi.repeaters.getVirtualList(e);o&&(o.replaceItem(t,i),o.update())},removeItemAt:function(e,t){var i=thoriumapi.repeaters.getVirtualList(e);if(i){i.deleteItem(t);for(var o=0;o<i.items.length;o++)i.items[o].dataindex=o;i.update();var r=i.el.querySelectorAll("ul .item-dbexpress");for(o=0;o<r.length;o++){(e=r[o]).setAttribute("data-index",o)}}},scrollToItem:function(e,t){var i=thoriumapi.repeaters.getVirtualList(e);i&&(i.scrollToItem(t),i.update())},moveItem:function(e,t,i){var o=thoriumapi.repeaters.getVirtualList(e);if(o){o.moveItem(t,i);for(var r=0;r<o.items.length;r++)o.items[r].dataindex=r;o.update();var a=o.el.querySelectorAll("ul .item-dbexpress");for(r=0;r<a.length;r++){(e=a[r]).setAttribute("data-index",r)}}},itemsCount:function(e){var t=thoriumapi.repeaters.getVirtualList(e);return t?t.items.length:0},reload:function(e){var t=thoriumapi.repeaters.getVirtualList(e);if(t){var i=t.el.getAttribute("data-service")||null;dbExpressData.getRepeaterData(t.el,i,null)}}},chartjs:{name:"Thorium Chart.JS Public API",initialize:function(){"undefined"!=typeof chartJS&&chartJS.initialize()},addDataSet:function(e,t,i,o){"undefined"!=typeof chartJS&&chartJS.addDataSet(e,t,i,o)},getChartInstanceFromId:function(e){"undefined"!=typeof chartJS&&chartJS.getChartInstanceFromId(e)},addDataPoint:function(e,t,i,o,r){"undefined"!=typeof chartJS&&chartJS.addDataPoint(e,t,i,o,r)},replaceDataPoint:function(e,t,i,o,r,a){"undefined"!=typeof chartJS&&chartJS.replaceDataPoint(e,t,i,o,r,a)},clearChart:function(e){"undefined"!=typeof chartJS&&chartJS.clearChart(e)},changeChartType(e,t){"undefined"!=typeof chartJS&&chartJS.changeChartType(e,t)}},date:{name:"Thorium Date-Time  Public API",getTimeStamp:function(){return(new Date).getTime()/1e3},getTimeStampFromDate:function(e){return new Date(e).getTime()/1e3},timeDiff:function(e,t){var i=6e4,o=36e5,r=864e5,a=30*r,n=365*r,l=e-t;return l<i?0==Math.round(l/1e3)?"now":Math.round(l/1e3)+" seconds ago":l<o?Math.round(l/i)+" minutes ago":l<r?Math.round(l/o)+" hours ago":l<a?Math.round(l/r)+" days ago":l<n?Math.round(l/a)+" months ago":Math.round(l/n)+" years ago"},getDateTimeFromTimeStamp:function(e,t){var i=new Date(1e3*e);if(!isNaN(i.getTime())){const e={year:"numeric",month:"numeric",day:"numeric"};return"datetime-local"==t&&(e.timeZone="UTC",e.timeZoneName="short",e.hour12=!1),i.toLocaleString("default",e)}thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error while converting UNIX time Stamp ["+e+"] to Date-Time")},ISO8601:function(e){var t=e.getDate();t<10&&(t="0"+t);var i=e.getMonth()+1;return i<10&&(i="0"+i),e.getFullYear()+"-"+i+"-"+t},getTime:function(e){var t="",i=e.getHours();1==kHours12&&(i>12?(i-=12,t="pm"):t="am"),i<10&&(i="0"+i);var o=e.getMinutes();return o<10&&(i="0"+o),(i+":"+o+" "+t).trim()}},firebase:{name:"Thorium Firebase Public API",logout:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.logoutExt()},showRegisterScreen:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.showRegisterScreen()},showEditProfilePageExt:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.showEditProfilePageExt()},facebookLogin:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.facebookLoginExt()},googleLogin:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.googleLoginExt()},twitterLogin:function(){"undefined"!=typeof firebasePlugin&&firebasePlugin.twitterLoginExt()},getUser:function(){if("undefined"!=typeof firebasePlugin)return firebase.auth().currentUser}}},thoriumCorePlugin={name:"Thorium Builder Core Plugin",bundleid:"com.thoriumbuilder.core",version:"2.0.0",isLoading:!1,httpRoot:"",language:"en",direction:"ltr",currentPopover:null,isLocal:function(){return thoriumapi.isLocal()},loadpage:function(e,t,i){thoriumapi.loadpage(e,t,i)},logEvent:function(e,t){thoriumapi.logEvent(e,t)},getpageparam:function(e){return thoriumapi.getpageparam(e)},reloadHomePage:function(){thoriumapi.reloadHomePage()},backToPreviousPage:function(){thoriumapi.backToPreviousPage()},txtToUrl:function(e){return thoriumapi.txtToUrl(e)},isSafari:function(){return thoriumapi.isSafari()},timeDiff:function(e,t){return thoriumapi.date.timeDiff(e,t)},showAlert:function(e){thoriumapi.showAlert(e)},showNotification:function(e,t,i,o,r){thoriumapi.showNotification(e,t,i,o,r)},showToast:function(e,t,i,o,r){thoriumapi.showToast(e,t,i,o,r)},openPopup:function(e){thoriumapi.openPopup(e)},getDateTimeFromTimeStamp:function(e,t){return thoriumapi.date.getDateTimeFromTimeStamp(e,t)},ISO8601:function(e){return thoriumapi.date.ISO8601(e)},getTime:function(e){return thoriumapi.date.getTime(e)},getObjectViewPortPercent:function(e,t){return thoriumapi.getObjectViewPortPercent(e,t)},findGetParameter:function(e){return thoriumapi.findGetParameter(e)},getVlTemplateHeight:function(e,t){var i,o=e.querySelector(".virtuallist-template");if(!(i=o?o.innerHTML:$("#"+e.id).data("template"))||0==i.length)return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Unable to get Template for Repeater with id ["+e.id+"]"),void app.preloader.hide();var r=e.offsetWidth;i=i.replace("url({{productimage}})","url('./img/defaultimg.png')");var a=document.createElement("div");r>0&&(a.style.width=r+"px");var n=e.classList.value;a.innerHTML=t>1?'<div class="'+n+' row no-gap multicol w-100 temptemplate">'+i+"</div>":'<div class="'+n+' w-100 temptemplate"><ul>'+i+"</ul></div>",document.getElementById("app").appendChild(a);var l=a.offsetHeight;-5==l&&(l=0),a.remove(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calculating Template Line Height ("+t+" columns) for Repeater with ID: ["+e.id+"] => ["+l+"px]");var u="tmp-"+e.id,c=document.getElementById(u);return c&&c.parentNode&&c.parentNode.removeChild(c),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Template Line Height ("+t+" columns) Applied for Repeater with ID: ["+e.id+"] => ["+l+"px]"),l||0},applyFormulaToField(e,t,o,r){var a=e.getAttribute("data-function"),n=e.getAttribute("data-date-type")||null,l=e.getAttribute("data-dbexpress-type")||null;if(a&&"boolean"==a){var u=e.getAttribute("data-icon-false"),c=e.getAttribute("data-icon-true"),s=e.getAttribute("data-color-false")||"",d=e.getAttribute("data-color-true")||"",m=e.getAttribute("data-icon-size")||"16",p='<i class="'+d+' f7-icons" style="font-size:'+m+'px;" >'+c+"</i>",h='<i class="'+s+' f7-icons" style="font-size:'+m+'px;" >'+u+"</i>";c&&u&&(t="1"==r?t.replaceAll("{{"+o+"}}",p):t.replaceAll("{{"+o+"}}",h))}else if(a&&"value"==a){s=e.getAttribute("data-color-false")||"",d=e.getAttribute("data-color-true")||"";s&&d&&(t=r>=0?t.replaceAll("{{datacolorclass}}",d):t.replaceAll("{{datacolorclass}}",s))}if(n&&r&&r.toString().length>0&&0!=r&&("datetime-local"==n||"date"==n)){var g=thoriumCorePlugin.getDateTimeFromTimeStamp(r,n);t=t.replaceAll("{{"+o+"}}",g)}else(r||"datetime-local"!=n&&"date"!=n)&&(!r||0!=r||"datetime-local"!=n&&"date"!=n)||(t=t.replaceAll("{{"+o+"}}",""));if(l&&"decimal"==l){r||(r=0);var f=e.getAttribute("data-decimals")||2,v=parseFloat(r).toFixed(f);Math.trunc(r),t=t.replaceAll("{{"+o+"}}",v)}if(l&&"rating"==l){r||(r=0);const e='<i class="fa f7-icons s-3" data-icon="star_fill">star_fill</i>';var b=parseInt(r)||0,w="";for(i=0;i<b;i++)w+=e;t=t.replaceAll("{{"+o+"}}",w)}return t},renderVlItem:function(e,t,i,o){for(const[o,n]of Object.entries(e)){var r=n;if("null"!=r&&null!=r||(r=""),"auth_photourl"==o&&0==r.length&&t.indexOf("{{auth_photourl}}")>=0&&(t=t.replace("url(db/dbassets/{{auth_photourl}})","url('./img/defaultavatar.png')")),t=t.replace("url(db/dbassets/)","url('./img/defaultimg.png')"),i){var a=i.querySelector('*[data-dbexpress-field="'+o+'"]');a&&(t=thoriumCorePlugin.applyFormulaToField(a,t,o,r))}t=t.replaceAll("{{"+o+"}}",r)}t=t.replace(/>{{.*}}</,">&nbsp;<");var n=new RegExp("({{[\\d\\D]*?}})","g");return t=t.replace(n,"'img/defaultimg.png'")},renderVirtualListFromData:function(e,t,i){var o=1;o=window.innerWidth>=768?e.getAttribute("data-col-count-tablet")||1:e.getAttribute("data-col-count")||1,t||thoriumapi.logEvent(1,"[com.thoriumbuilder.core] renderVirtualListFromData initialized with null items");var r=t.length||0;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Rendering Repeater Virtual List ["+r+" rows]");var a=!0,n=thoriumCorePlugin.getVlTemplateHeight(e,o);o>1&&(a=!1),(c=app.virtualList.get(e))&&app.virtualList.destroy(c),t.length||(t.length=0);var l=e.querySelector(".templaterow");const u='<h3 class="text-center w-100 pt-2">'+(e.getAttribute("data-noresult")||"no results found")+"</h3>";var c,s=(c=app.virtualList.create({el:e,items:t,createUl:a,cols:o,setListHeight:!0,emptyTemplate:u,searchAll:function(e,t){for(var i=[],o=0;o<t.length;o++){(JSON.stringify(t[o]).toLowerCase().indexOf(e.toLowerCase())>=0||""===e.trim())&&i.push(o)}return i},renderItem:e=>thoriumCorePlugin.renderVlItem(e,i,l,n),height:n})).$el[0];if(s&&(s.setAttribute("data-loaded",!0),s.setAttribute("data-count",t.length)),c=app.virtualList.get(e)){const t=c.params.height,i=e.querySelector("li");if(i){const e=i.offsetHeight||0;e>0&&e!=t&&(c.params.height=e,c.update())}}app.preloader.hide()},getMedialistLine:function(e,t){for(const[i,o]of Object.entries(e))t=t.replaceAll("{{"+i+"}}",o);return t},renderVirtualMediaListData:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Rendering Virtual List Data");var i=e.getAttribute("data-template")||null;if(!i)return $("#"+e.id).hide(),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] No template defined"),void thoriumCorePlugin.showAlert("[com.thoriumbuilder.core] No template defined");var o=e.getAttribute("data-height-ios")||104,r=e.getAttribute("data-height-md")||111,a=app.virtualList.create({el:e,items:t,createUl:!0,setListHeight:!0,searchAll:function(e,t){for(var i=[],o=0;o<t.length;o++){(JSON.stringify(t[o]).toLowerCase().indexOf(e.toLowerCase())>=0||""===e.trim())&&i.push(o)}return i},renderItem:e=>thoriumCorePlugin.getMedialistLine(e,i),height:"ios"===app.theme?o:"md"===app.theme?r:111}).$el[0];a&&(a.setAttribute("data-loaded",!0),a.setAttribute("data-count",t.length))},getVirtualMediaListData:function(e,t){var i=[],o=$("#"+e.id);if(o){var r=app.virtualList.get(o);r&&app.virtualList.destroy(r);var a="js/json/"+t;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Loading Virtual List Data from Json at ["+a+"]"),app.preloader.show(),fetch(a,{method:"get",headers:{"Content-type":"application/json"}}).then((function(t){t.json().then((t=>{thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Received Data from ["+a+"]");var o=0,r={};for(var n in t)(r=t[n]).dataindex=o,o+=1,i.push(r);thoriumCorePlugin.renderVirtualMediaListData(e,i),app.preloader.hide()})).catch((function(t){$("#"+e.id).hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+t.message+"] While loading data from ["+a+"]"),thoriumCorePlugin.showAlert(t.message)}))})).catch((function(t){$("#"+e.id).hide(),app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+t.message+"]"),0==app.online?thoriumCorePlugin.showNotification("Internet connection lost"):app.dialog.alert(t.message)}))}},initVirtualMediaLists:function(){const e=document.querySelectorAll(".virtual-media-list");for(var t=0;t<e.length;t++){var i=e[t];if("true"!=i.getAttribute("data-loaded")&&"true"==i.getAttribute("data-virtual-list")){app.preloader.show();var o=i.getAttribute("data-json-source")||null;o&&thoriumCorePlugin.getVirtualMediaListData(i,o)}}},geolocation:function(e){if(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Trying to geolocate user..."),navigator.geolocation)try{navigator.geolocation.getCurrentPosition((function(t){e.value=t.coords.latitude+","+t.coords.longitude,$("#"+e.id).data("pos",t),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] User Geolocated "+t.coords.latitude+","+t.coords.longitude)}),(function(t){thoriumapi.logEvent(2,"[com.thoriumbuilder.core] "+t.message),e.value=t.message}))}catch(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.core] "+e.message),thoriumCorePlugin.showAlert(e.message)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Geolocation is not supported."),e.value="Geolocation is not supported."},fillSelect:function(e,t,i,o,r){"true"!=e.getAttribute("data-loaded")&&($("#"+e.id).addClass("disabled"),app.preloader.show(),"2"==o?"object"==typeof firestorePlugin&&firestorePlugin.initFormSelectWithCollection(e,t,i):(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calling Api  ["+t+"]"),fetch(t,{method:"get",headers:{"Content-type":"application/json"}}).then((function(o){o.json().then((o=>{thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Api received Response from url ["+t+"]"),app.emit("dataloadSuccess",e);var a='<option value="" disabled></option>';for(var n in r=r||i,o)a=a+'<option value="'+o[n][r]+'">'+o[n][i]+"</option>";e.innerHTML=a;var l=e.getAttribute("data-value")||"";if(l.length>0){var u=$(e).closest(".smart-select");if(u){var c=app.smartSelect.get(u);c&&c.setValue(l)}else e.value=l}$("#"+e.id).removeClass("disabled"),e.setAttribute("data-loaded","true"),setTimeout((function(){app.preloader.hide()}),1e3)})).catch((function(e){$("#"+field.id).hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"] While loading data from ["+t+"]"),thoriumCorePlugin.showAlert(e.message)}))})).catch((function(e){app.preloader.hide(),thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"]"),0==app.online?thoriumCorePlugin.showNotification("Internet connection lost"):app.dialog.alert(e.message)}))))},initForm:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing Form with id ["+e.id+"]");for(var t=e.querySelectorAll("input[data-autofill='true']"),i=0;i<t.length;i++){var o=t[i],r=o.getAttribute("type"),a=o.getAttribute("data-date-type")||null,n=o.value;if(0==n.length){if("date"==r&&(o.value=thoriumCorePlugin.ISO8601(new Date)),"time"==r&&(o.value=thoriumCorePlugin.getTime(new Date)),"datetime-local"==r&&(o.value=thoriumCorePlugin.ISO8601(new Date)+" "+thoriumCorePlugin.getTime(new Date)),"geo"==r&&thoriumCorePlugin.geolocation(o),"datetime-local"==a||"date"==a){n=thoriumapi.date.getTimeStamp(),o.setAttribute("data-timestamp",n);var l=thoriumCorePlugin.getDateTimeFromTimeStamp(n,a);o.setAttribute("value",l),o.value=l}thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+o.name+"] with attribute AutoFill initialized with value ["+o.value+"]")}}if($("#"+e.id+" select[data-api-mode]").each((function(e){var t=e.getAttribute("data-api")||null,i=e.getAttribute("data-api-field")||null,o=e.getAttribute("data-select-collection")||null,r=e.getAttribute("data-api-fieldid")||null,a=0;a=e.getAttribute("data-api-mode")||"0",t&&"0"==a&&(a=1),"1"==a&&t&&i?(thoriumCorePlugin.fillSelect(e,t,i,a,r),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+e.name+"] of type Select initialized from api ["+t+"]")):"2"==a&&o&&i&&(setTimeout((function(){thoriumCorePlugin.fillSelect(e,o,i,a,r)}),100),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Input ["+e.name+"] of type Select initialized from api ["+t+"]"))})),"object"==typeof dbExpressData)for(t=document.querySelectorAll("#"+e.id+" select[data-service]"),i=0;i<t.length;i++){var u=t[i],c=u.getAttribute("data-service")||null,s=document.querySelector(".page-current");if(s){var d=s.getAttribute("data-record-service")||null,m=s.getAttribute("data-record-pk")||null;d&&m&&c==d&&u.setAttribute("data-value",m)}c&&dbExpressData.fillSmartSelect(u,c)}},initForms:function(){for(var e=document.querySelectorAll(".form-ajax-submit"),t=0;t<e.length;t++){var i=e[t];"true"!=(i.getAttribute("data-loaded")||"false")&&"shoppingcartform"!=i.id&&"form-orderprocess"!=i.id&&"dbexpress-signin-form"!=i.id&&"resetpw-form"!=i.id&&"register-form"!=i.id&&"dbexpress-profile-form"!=i.id&&thoriumCorePlugin.initForm(i)}},submitForm:function(e,t){var i=e.target;if(0==app.input.validateInputs(i))return void thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Missing Mandatory fields for Form with id ["+i.id+"]");const o=t.attr("data-parent-key")||null;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Submiting Form with id ["+i.id+"]");var r=t.attr("data-mode")||null;if(0==r||1==r||2==r){e.preventDefault;var a=t.attr("data-form-message");if(1==thoriumapi.isLocal()&&0==r)return t[0].reset(),a.length>0&&thoriumCorePlugin.showAlert(a),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] This Form can't send an email when running from the simulator"),void thoriumCorePlugin.showNotification("This Form can't send an email when running from the simulator");thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Formating Data for Form with id ["+i.id+"]");for(var n=new FormData,l=0;l<i.length;l++){const e="_alias",t=["name"+e,"id"+e,"description"+e,"this"+e,"title"+e,"submit"+e];var u=i[l].name;!0===t.includes(u)&&(u=u.replaceAll(e,""));var c,s=i[l].type;if(c="text"==s?i.querySelector("input[name="+u+"]").getAttribute("type"):null,"radio"==s)!0===i[l].checked&&n.append(u,i[l].value);else if("checkbox"==s)n.append(u,i[l].checked);else if("submit"==s);else if("file"==s){var d=i[l].id,m=$("#"+d);if(m){var p=m.data("data-blob");p||(p=""),n.append(u,p)}}else if("datetime-local"==c){var h=i[l].getAttribute("data-timestamp")||null;h?n.append(u,h):n.append(u,i[l].value)}else n.append(u,i[l].value)}var g,f="",v=!1,b="multipart/form-data",w=!0,P="",A="",C=0,S="POST";if(2==r){var E=t.attr("data-form-function");if(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Calling Function ["+E+"] for Form with id ["+i.id+"]"),E){var y=window[E],k=[i,n];if("function"==typeof y){y.apply(this,k);app.preloader.hide(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Function ["+E+"] Called for Form with id ["+i.id+"]"),a.length>0&&thoriumCorePlugin.showAlert(a)}else{app.preloader.hide();var T='[com.thoriumbuilder.core] An error occured "'+E+'" is not an existing function';thoriumapi.logEvent(2,T),thoriumCorePlugin.showAlert(T),app.emit("userFormError",T,i,0,null)}}return}if(0==r){var I=t.attr("data-email")||null;if(!I){T="Recipient email not set for the form";return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error: ["+T+"] when submitting Form with id ["+i.id+"]"),thoriumCorePlugin.showAlert(T),void app.emit("userFormError",T,i,0,null)}L=thoriumCorePlugin.httpRoot+"forms/form.php";var D=t.attr("data-email-title");n.append("form_email",I),n.append("form_title",D),S="POST",b="multipart/form-data",g=!0,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Set Data for Form with id ["+i.id+"]")}else{var L,x=t.attr("data-api-data-mode")||0,F=t.attr("data-api-root")||"";f=t.attr("data-api-header")||null;if(!(L=t.attr("data-api-url"))){T="form url not defined!";return thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error: ["+T+"] when submitting Form with id ["+i.id+"]"),thoriumCorePlugin.showAlert(T),void app.emit("userFormError",T,i,0,null)}if(o&&(L=L.replaceAll("{key}",o)),0==x)b="multipart/form-data",g=!0;else{var R;F.length>0?(R={[F]:{}},n.forEach((function(e,t){R[F][t]=e}))):(R={},n.forEach((function(e,t){R[t]=e})));var _=JSON.stringify(R);data=_,b="application/json",g=!1}S=t.attr("data-api-method")||"POST"}const B=t.attr("data-form-beforesubmit");if(B){const e=window[B];var M={};M.formdata=n,M.headers=f,M.url=L,M.crossDomain=v,M.contentType=b,M.async=w,M.username=P,M.password=A,M.timeout=C,M.method=S;k=[i,M];if("function"==typeof e){var O=e.apply(this,k);thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Function ["+B+"] Called for Form with id ["+i.id+"]"),O&&(n=O.formdata,f=O.headers,L=O.url,v=O.crossDomain,b=O.contentType,w=O.async,P=O.username,A=O.password,C=O.timeout,S=O.method)}else{T='[com.thoriumbuilder.core] An error occured "'+B+'" is not an existing function';thoriumapi.logEvent(2,T)}}thoriumapi.logEvent(0,"Sending Data to: ["+L+"] from Form with id ["+i.id+"]"),app.request({url:L,data:n,method:S,crossDomain:v,contentType:b,headers:f,timeout:C,processData:g,username:P,password:A,async:w,beforeSend(){app.preloader.show()},error(e,o){app.preloader.hide();var r=t.attr("data-form-error-message")||"",a=(e.responseText+" "+e.statusText).trim();thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Form Error: ["+a+"] when submitting Form with id ["+i.id+"]"),r.length>0?thoriumCorePlugin.showAlert(r):thoriumCorePlugin.showAlert("An error occured ["+e.responseText+" "+e.statusText+"] when submitting Form with id ["+i.id+"]"),app.emit("userFormError",a,i,o,e)},success(o,r,n){app.preloader.hide(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form with id ["+i.id+"] Sent with Success"),a.length>0&&thoriumCorePlugin.showAlert(a),app.emit("userFormSuccess",o,i,r,n),"true"==(t.attr("data-reset-form")||"false")&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Reset"),e.target.reset(),$("#"+e.target.id+" .text-editor").each((function(e){var t=app.textEditor.get("#"+e.id);t&&t.setValue("")})),$(".firebase_document_preview").css("background-image",""),$(".input-filename span").html(""),$(".firebase_fileupload-rotate").hide(),$(".firebase_fileupload-remove").hide(),$(".input-filename i").hide());var l=t.attr("data-return-function")||null;if(l){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form with id ["+i.id+"] : Calling JS function ["+l+"]");var u=window[l],c=[i,o,r,n];if("function"==typeof u){u.apply(this,c);app.preloader.hide(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] JS function ["+l+"] called successfully when submitting Form with id ["+i.id+"]")}else{app.preloader.hide();var s='An error occured "'+l+'" is not an existing function';thoriumapi.logEvent(2,"[com.thoriumbuilder.core] JS function ["+l+"] called with Error: ["+s+"] when submitting Form with id ["+i.id+"]"),thoriumCorePlugin.showAlert(s),app.emit("userFormError",s,i,r,n)}}var d=t.attr("data-form-postprocess")||0;0==d?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Form Sent"):1==d?(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Going Back to Previous Page"),thoriumCorePlugin.backToPreviousPage()):2==d&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Reloading Home Page"),thoriumCorePlugin.reloadHomePage())}})}},getPhotoBrowserNavbar:function(){return'<div class="navbar navbar-photo-browser">                 <div class="navbar-bg"></div>                 <div class="navbar-inner navbar-inner-centered-title">                   <div class="left">                     <a class="link webshare" data-webshare-textref="" data-webshare-imgref=".swiper-slide-active .swiper-zoom-container img" >                         <i class="fa material-icons">share</i>                     </a>                   </div>                   <div class="title">                     <span class="photo-browser-current"></span>                     <span class="photo-browser-of">/</span>                     <span class="photo-browser-total"></span>                   </div>                   <div class="right">                     <a class="link popup-close" data-popup=".photo-browser-popup">                       <span>'+kPhotoBrowserBackLinkText+"</span>                     </a>                   </div>                 </div>               </div>"},showPhotoBrowser:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Photo Browser"),t=t||0;var i=e.length>1,o=null;1==kWebShareApi&&(o=thoriumCorePlugin.getPhotoBrowserNavbar);var r=app.photoBrowser.create({swipeToClose:!0,photos:e,backLinkText:kPhotoBrowserBackLinkText,navbarOfText:"/",theme:kPhotoBrowserTheme,captionsTheme:kPhotoBrowserTheme,navbar:!0,toolbar:i,type:"standalone",lazyLoading:!0,captionTemplate:"title",navbarTemplate:"title",renderNavbar:o,swiper:{effect:kPhotoBrowserEffect,kPhotoBrowserAutoPlay:kPhotoBrowserAutoPlay,grabCursor:!0,spaceBetween:20,speed:300,loop:!1,preuploadFileReads:!1,zoom:{enabled:!0,maxRatio:3,minRatio:1},lazy:{enabled:!1}}});r.open(t),app.emit("photobrowserDisplayed",r)},applyEffect:function(e){if("false"==(e.getAttribute("data-effect-loaded")||"false")){var t=e.getAttribute("data-transform-effect")||"";e.style.transform=t;var i=e.getAttribute("data-transform-opacity")||"";e.style.opacity=i,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Apply Effect to element "+e.id+" ["+t+"]"),e.setAttribute("data-effect-loaded","true")}},resetEffect:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Remove Effect from element "+e.id);var t=e.getAttribute("data-stored-state")||"";e.style.transform=t;var i=e.getAttribute("data-initial-opacity")||"";e.style.opacity=i},scrolleffectsHandler:function(e){const t=document.querySelectorAll("* [data-transform-trigger='viewport']:not(.activeeffect)");for(var i=0;i<t.length;i++){var o=t[i];if(thoriumCorePlugin.getObjectViewPortPercent(o,e.scrollTop)>(o.getAttribute("data-transform-viewport")||0)){o.classList.add("activeeffect");var r=o.getAttribute("data-transform-effect")||"";o.style.transform=r;var a=o.getAttribute("data-transform-opacity")||"";o.style.opacity=a}}},initEffects:function(){$("* [data-transform-trigger='pageload']").each((function(e){thoriumCorePlugin.applyEffect(this)}))},setStyle:function(){kCustomColor&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Apply Custom Color "+kCustomColor),document.documentElement.style.setProperty("--f7-theme-color",kCustomColor))},initializeServiceWorker:function(){"serviceWorker"in navigator&&"file:"!=window.location.protocol?navigator.serviceWorker.controller?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Thorium Service worker found"):navigator.serviceWorker.register("OneSignalSDKWorker.js",{scope:"./"}).then((function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Thorium Service worker registered for scope:"+e.scope)})).catch((function(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.core] Error ["+e.message+"] While loading oneSignal Service Worker"),thoriumCorePlugin.showAlert(e.message)})):thoriumapi.logEvent(1,"[com.thoriumbuilder.core] No Service Worker Support on this Device");var e=window.OneSignal||[];e.push((function(){e.init({appId:kOneSignalAppId})})),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] One Signal Plugin Initialization with ID ["+kOneSignalAppId+"]")},webShare:function(e,t){if(e.preventDefault(),null==navigator.share)thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Web Share only possible with https web sites"),thoriumCorePlugin.showAlert("Web Share only possible with https web sites");else{var i=t.attr("data-webshare-title")||app.name,o="",r=t.attr("data-webshare-imgref");r&&(o=$(r).attr("src")||"");var a="";a=o?i:t.attr("data-webshare-textref")||window.location.href,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Call Navigator.share"),navigator.share({title:i,url:o,text:a})}},showImageZoom:function(e){e.preventDefault,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Photo Browser");var t=e.target;if(t){var i=[],o=t.getAttribute("src"),r=t.getAttribute("title");if(!o){if((o=t.style.backgroundImage).indexOf(",")>-1){var a=o.substring(0,o.indexOf(","));o=a}o=o.replace("url(","").replace(")","").replace(/\"/gi,"")}var n={};n.url=o,n.caption=r,i.push(n),thoriumCorePlugin.showPhotoBrowser(i,0)}},showMedialistZoom:function(e,t){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Medialist Photo Browser");var i=e.closest(".virtual-list");if(i){var o=app.virtualList.get(i);if(o){for(var r=[],a=e.getAttribute("data-index")||0,n=0;n<o.items.length;n++){var l={};l.url=o.items[n].imagesrc,l.caption=o.items[n].title,document.querySelector("#"+i.id+' .medialist-zoom[data-index="'+n+'"]')&&r.push(l)}thoriumCorePlugin.showPhotoBrowser(r,parseInt(a))}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Medialist Item Parent VL not found")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Medialist Item Parent VL not found")},showCollectionZoom:function(e,t){var i;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Collection Photo Browser");var o=[],r=0,a=e.querySelector(".collection-item-image");a&&(i=a.getAttribute("data-file"));var n=e.closest(".collection");if(n)for(var l=n.querySelectorAll(".collection-item:not(.templaterow)"),u=0;u<l.length;u++){var c=l[u].querySelector(".collection-item-image");if(c){var s={};const e=c.getAttribute("data-file");s.url=e,s.caption=c.getAttribute("title"),o.push(s),e==i&&(r=u)}}thoriumCorePlugin.showPhotoBrowser(o,r)},showPopover:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Show Popover");var t=e.getAttribute("data-content");t&&(thoriumCorePlugin.currentPopover=app.popover.create({targetEl:e,content:'<div class="popover"><div class="popover-inner">'+t+"</div></div>"}),thoriumCorePlugin.currentPopover.open())},translate:function(e,t){var i=document.documentElement.lang||"en";document.documentElement.dir;e||(e=sessionStorage.getItem("thorium.language")||i),t||"undefined"==(t=sessionStorage.getItem("thorium.direction"))&&(t=thoriumCorePlugin.direction),"undefined"==e&&(e=i),t=t||"ltr",document.documentElement.dir=t,thoriumCorePlugin.language=e,thoriumCorePlugin.direction=t,sessionStorage.setItem("thorium.language",e),sessionStorage.setItem("thorium.direction",t),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Translate Screen to "+e),thoriumCorePlugin.multilingual=!0;var o="data-translate-"+e;$("* ["+o+"]").each((function(e){var t=$(this).length,i=$(this).attr(o);i.length>0&&(1==t?$(this).html(i):$(this).text(i))}))},pullToRefreshHandle:function(e){var t,i=$(".ptr-content");e&&(t=e.detail.route.query.key||null),i.on("ptr:refresh",(function(e){0==thoriumCorePlugin.isLoading&&(thoriumCorePlugin.isLoading=!0,thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Call to 'Pull to Refresh'"),setTimeout((function(){var o=e.target.getAttribute("data-ptr-repeater");$("#"+o).hasClass("firebase-virtual-list-content")&&($("#"+o).attr("data-loaded","false"),"object"==typeof firestorePlugin&&firestorePlugin.firebase_initFirebaseVirtualLists(!1,t)),$("#"+o).hasClass("json-virtual-list-content")&&($("#"+o).attr("data-loaded","false"),"object"==typeof jsonApiPlugin&&jsonApiPlugin.initAllRepeaters(t)),$("#"+o).hasClass("dbexpress-virtual-list-content")&&($("#"+o).attr("data-loaded","false"),"object"==typeof dbExpressData&&dbExpressData.initAllRepeaters(t)),i.removeClass("ptr-pull-up"),i.removeClass("ptr-transitioning"),i.removeClass("ptr-refreshing"),thoriumCorePlugin.isLoading=!1}),1e3))}))},addToHomeScreen:function(){if(!(0==kAddToHomeScreenIos&&1==app.device.ios||0==kAddToHomeScreenMd&&1==app.device.android)){var e;e=1==app.device.ios?(e=kAddToHomeScreenIosText).replaceAll("#ICON",'<i class="fa f7-icons">square_arrow_up</i>'):(e=kAddToHomeScreenMdText).replaceAll("#ICON",'<span class="fa material-icons">more_vert</span>');var t='<div class="sheet-modal addtohomescreen"><div class="sheet-modal-inner"><p class="ahs-title font-weight-bold">'+kAddToHomeScreenTitle+"</p><p>"+e+"</p>";1==kSkipButton&&(t=t+'<p><a class="link sheet-close">'+kSkipButtonText+"</a></p>"),t+='<p class="ios-only"><i class="fa f7-icons">chevron_down</i></p></div></div>',app.sheet.create({swipeToClose:!1,backdrop:!0,closeOnEscape:!1,closeByBackdropClick:!1,content:t}).open(!0)}},disableBounce:function(){},initialize:function(){if(1==app.initialized){var e=$(".apploader");e&&app.preloader.showIn(e),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Initializing App.."),1==kMultilingual&&thoriumCorePlugin.translate(),kOneSignalAppId.length>0&&thoriumCorePlugin.initializeServiceWorker(),0!=thoriumCorePlugin.isLocal()||0!=kDesktopAllowed||!app.device.desktop&&Framework7.support.touch&&(app.device.android||Framework7.device.ios)?(1==app.device.desktop&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Desktop mode"),1==Framework7.support.touch&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Touch support detected"),1==app.device.android&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Android Device detected"),1==app.device.ios&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] iOS Device detected"),1==app.device.cordova||1==app.device.capacitor?thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is running in Native Hybrid mode"):1==app.device.webView&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] App is installed to Home Screen"),1==kHybridAppsLog&&thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Debug Log is activated"),1==app.device.cordova||1==app.device.capacitor?(thoriumapi.logEvent(0,"[com.thoriumbuilder.sqlite] App is running in Native Hybrid mode, set DB host to ["+kRemoteHost+"]"),thoriumCorePlugin.httpRoot=kRemoteHost):1==thoriumCorePlugin.isLocal()?(thoriumapi.logEvent(0,"[com.thoriumbuilder.sqlite] App is running in Local mode, set DB host to ["+kLocalRoot+"]"),thoriumCorePlugin.httpRoot=kLocalRoot):(thoriumapi.logEvent(0,"[com.thoriumbuilder.sqlite] App is running in PWA mode, set DB host to empty"),thoriumCorePlugin.httpRoot=""),1==kForceInstall&&0==app.device.webView&&"file:"!=window.location.protocol&&0==app.device.cordova&&(app.device.ios||app.device.android)&&thoriumCorePlugin.addToHomeScreen(),thoriumCorePlugin.setStyle(),$(".apploader").hide(),thoriumCorePlugin.initAllSwipers(),thoriumCorePlugin.initForms(),thoriumCorePlugin.initVirtualMediaLists(),thoriumCorePlugin.initAllTextEditors(),thoriumCorePlugin.initAllCalendars(),thoriumCorePlugin.initAllTimePickers(),thoriumCorePlugin.initAllAutoComplete(),thoriumCorePlugin.pullToRefreshHandle(null),1==app.device.cordova&&$(".webshare").hide(),setTimeout((function(){thoriumCorePlugin.initEffects()}),100),app.emit("appInitialised")):(e&&app.preloader.hideIn(e),$("#page").hide(),$(".apploader").hide(),thoriumCorePlugin.showToast("This App can only run on a Mobile device",!1,"center",9999999)),thoriumCorePlugin.disableBounce()}$(".apploader").hide()},resize:function(){for(var e=document.querySelectorAll(".virtual-list"),t=0;t<e.length;t++){var i=e[t],o=app.virtualList.get(i);if(o){const e=o.params.height,t=i.querySelector("li");if(t){const i=t.offsetHeight||0;i>0&&i!=e&&(o.params.height=i,o.update())}}}thoriumCorePlugin.disableBounce()},initSwiper:function(e){var t=$("#"+e),i=document.getElementById(e);if(t)app.swiper.get(i)},initAllSwipers:function(){$(".swiper-container").each((function(e){thoriumCorePlugin.initSwiper(e.id)}))},initTextEditor:function(e){if($("#"+e.id).attr("texteditor-initialized",!0),"true"!=status)return $("#"+e.id).attr("texteditor-initialized",!0),app.textEditor.create({el:"#"+e.id,buttons:kTextEditorButtons,on:{change:function(e){var t=e.el.id+"-shadow",i=e.value||"";i=i.replaceAll("<p></p>","").trim();var o=document.getElementById(t);o&&(o.value=i)},init:function(e){var t=e.el.id+"-shadow",i=e.value||"";i=i.replaceAll("<p></p>","").trim();var o=document.getElementById(t);o&&(o.value=i)}}})},initAllTextEditors:function(){$(".text-editor").each((function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Init Text Editor Instance with ID ["+e.id+"]");var t=app.textEditor.get("#"+e.id);t||(t=thoriumCorePlugin.initTextEditor(e))}))},initCalendar:function(e,t,i){if("true"!=$("#"+e).attr("calendar-initialized")){var o=app.calendar.get("#"+e);if(!o){var r;r=1==t?kDateTimeFormat:kDateFormat;var a=null;1==i&&(a=new Date).setDate(a.getDate()-1),(o=app.calendar.create({inputEl:"#"+e,inputReadOnly:!0,timePicker:t,timePickerFormat:{hour:"numeric",minute:"numeric"},touchMove:!1,animate:!0,backdrop:!0,closeOnSelect:!0,weekHeader:!0,monthSelector:!0,monthPicker:!0,yearSelector:!0,dateFormat:r,minDate:a,on:{change:function(e,t){var i=new Date(t);i.getFullYear(),i.getMonth(),i.getDate();e.inputEl.value=i.toLocaleString();var o=i.getTime()/1e3;e.inputEl.setAttribute("data-timestamp",o)},open:function(e){var t=e.inputEl.getAttribute("data-timestamp")||null;if(t){const o=new Date(1e3*t);e.currentYear=o.getFullYear(),e.currentMonth=o.getMonth(),e.setValue([o]);var i=document.querySelector(".calendar .current-year-value");i&&(i.textContent=o.getFullYear()),e.update()}},init:function(e){}}})).dayNames=kdayNames,o.dayNamesShort=kdayNamesShort,o.monthNames=kmonthNames,o.monthNamesShort=kmonthNamesShort,$("#"+e).attr("calendar-initialized",!0)}}},initAllCalendars:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Desktop Mode detected, initializing Calendar Fallback");const e=document.querySelectorAll("input[data-date-type]");for(var t=0;t<e.length;t++){var i=e[t];if(1!=("true"==i.getAttribute("calendar-initialized")||!1)){var o=i.getAttribute("data-date-type");thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Init Calendar Instance with ID ["+i.id+"]");var r="datetime-local"==o||!1,a="true"==i.getAttribute("data-date-min-today")||!1;thoriumCorePlugin.initCalendar(i.id,r,a)}}},initTimePicker:function(e){if("true"!=$("#"+e).attr("picker-initialized")){var t,i,o=app.picker.get("#"+e);if(!o)t=0==kHours12?[{values:function(){for(var e=[],t=0;t<=23;t++)e.push(t);return e}()},{divider:!0,content:":"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()}]:[{values:function(){for(var e=[],t=0;t<=12;t++)e.push(t<10?"0"+t:t);return e}()},{divider:!0,content:":"},{values:function(){for(var e=[],t=0;t<=59;t++)e.push(t<10?"0"+t:t);return e}()},{divider:!0,content:" "},{values:(i=[],i.push("am"),i.push("pm"),i)}],o=app.picker.create({inputEl:"#"+e,backdrop:!0,toolbarCloseText:"Done",cols:t,on:{init:function(t){var i=$("#"+e).val(),o=i.substr(0,i.indexOf(":")),r=i.substr(i.indexOf(":")+1,2),a=i.substr(i.indexOf(" ")+1,2);t.setValue([o,r,a],200)},change:function(t,i,o){var r=t.value[0]+":"+t.value[1];1==kHours12&&(r=r+" "+t.value[2]),setTimeout((function(){$("#"+e).val=$("#"+e).val(r)}),100)}}}),$("#"+e).attr("picker-initialized",!0)}},initAllTimePickers:function(){("windows"==app.device.os||(navigator.platform="MacIntel")&&1==thoriumCorePlugin.isSafari())&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Desktop Mode detected, initializing Time Picker Fallback"),$("input[type='time']").each((function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Init Picker Instance with ID ["+e.id+"]"),thoriumCorePlugin.initTimePicker(e.id)})))},initAllAutoComplete:function(){for(var e=document.querySelectorAll(".autocomplete"),t=0;t<e.length;t++){var i=e[t];const o=i.getAttribute("data-autocomplete")||null;if(o&&o.length>0){const e=o.split(",");autocompleteDropdownSimple=app.autocomplete.create({inputEl:i,openIn:"dropdown",source:function(t,i){var o=[];if(0!==t.length){for(var r=0;r<e.length;r++)e[r].toLowerCase().indexOf(t.toLowerCase())>=0&&o.push(e[r]);i(o)}else i(o)}})}}},uploadFileRead:function(e,t){var i=t.getAttribute("data-resize")||800;if(1==("true"==t.getAttribute("data-postfile")||!1)&&e){const i=t.accept.toLowerCase(),r=e.type.toLowerCase(),a=e.name.split(".").pop().toLowerCase();if(1==i.includes("audio")){if(0==r.includes("audio"))return void app.dialog.alert(e.name+" is not a valid Audio file")}else if(1==i.includes("video")){if(0==r.includes("video"))return void app.dialog.alert(e.name+" is not a valid Video file")}else if(1==i.includes("image")){if(0==r.includes("image"))return void app.dialog.alert(e.name+" is not a valid Image file")}else if(0==i.includes(a))return void app.dialog.alert(e.name+" is not a valid "+i+" file");$("#"+t.id).data("data-blob",e),$("#"+t.id+"-filename").text(e.name);var o=t.id.replace("-fileinput","");return $("#"+o+"-remove")&&$("#"+o+"-remove").show(),$("#"+o+"-fileinput-filename").css("visibility","visible"),$("#"+o+"-fileinput-filename").html('<i class="fa f7-icons">paperclip</i><span>'+e.name+"</span>"),$("#"+o+"-fileinput-filename").show(),void $("#"+o+"-fileinput").attr("data-modified","true")}var r=!1,a=t.accept.toLowerCase();1!=a.includes("image/png")&&1!=a.includes("image/jpeg")&&1!=a.includes("image/gif")&&1!=a.includes("image/*")||(r=!0);var n=(e.size/1024/1024).toFixed(4);if(1==r&&n>kImgMaxSize||0==r&&n>kDocMaxSize)app.dialog.alert("File too large (Max Size Allowed: "+kImgMaxSize+"Mb)");else if(r){if(!e.type.match(/image.*/))return void app.dialog.alert("The dropped file is not an image!");(l=new FileReader).onload=function(o){thoriumCorePlugin.resizeImage(e,i).then((function(i){var o=t.id.replace("-fileinput",""),r=thoriumCorePlugin.dataURItoBlob(i);r.name=e.name,$("#"+o+"-fileinput").data("data-blob",i),$("#"+o+"-fileinput").data("data-type",r.type||"image/jpg"),$("#"+o+"-fileinput").data("data-filename",e.name),$("#"+o).css("background-image","url('"+i+"')"),$("#"+o+"-rotate")&&$("#"+o+"-rotate").css("display","block"),$("#"+o+"-remove")&&$("#"+o+"-remove").css("display","block"),$("#"+o+"-fileinput").attr("data-modified","true")}))},l.readAsDataURL(e)}else{var l;(l=new FileReader).onload=function(i){var o=t.id.replace("-fileinput",""),r=l.result;$("#"+o+"-fileinput").data("data-blob",r),$("#"+o+"-fileinput").data("data-type",t.type),$("#"+o+"-fileinput").data("data-filename",e.name),$("#"+o+"-remove")&&$("#"+o+"-remove").show(),$("#"+o+"-fileinput-filename").css("visibility","visible"),$("#"+o+"-fileinput-filename span").text(e.name),$("#"+o+"-fileinput-filename i").show(),$("#"+o+"-fileinput-filename").show(),$("#"+o+"-fileinput").attr("data-modified","true")},l.readAsDataURL(e)}},resizeImage:function(e,t){return new Promise((function(i,o){var r="x",a=new FileReader;a.onloadend=function(){var n=new Image;n.src=a.result,n.onload=function(){var o=n.width,a=n.height;o>a?o>t&&(a*=t/o,o=t):a>t&&(o*=t/a,a=t);var l=document.createElement("canvas");l.width=o,l.height=a,l.getContext("2d").drawImage(this,0,0,o,a);var u=e.type||"image/jpg";r=l.toDataURL(u),i(r)},n.onerror=function(e){o("Image Resize Error "+e)}},a.readAsDataURL(e)}))},rotateImage:function(e,t){return new Promise((function(i,o){var r=new Image;r.src=e,r.onload=function(){var e=r.width,o=r.height,a=document.createElement("canvas");a.width=e,a.height=o;var n=a.getContext("2d");a.width=o,a.height=e,(n=a.getContext("2d")).translate(o,0),n.rotate(90*Math.PI/180),n.drawImage(this,0,0,e,o),t=t||"image/jpg",dataURL=a.toDataURL(t),i(dataURL)},r.onerror=function(e){o("Unable to rotate Image "+e)}}))},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(t.length),r=new Uint8Array(o),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return new Blob([o],{type:i})},uploadFile:function(e,t,i,o,r,a){var n=(t=t.replace("C:\\fakepath\\","")).substr(t.lastIndexOf(".")+1),l=firebase.storage().ref().child(i+"/");t=r+"_"+o+"."+n;var u=thoriumCorePlugin.dataURItoBlob(e);l.child(t).put(u).catch((function(e){app.preloader.hide(),app.dialog.alert(e.message)})).then((function(e){e.task.on("state_changed",(function(e){}),(function(e){app.preloader.hide(),app.dialog.alert(e.message)}),(function(e){l.child(t).getDownloadURL().then((function(e){a.update({[r]:e}).catch((function(e){app.preloader.hide(),app.dialog.alert("Error writing Image: "+e.message)}))})).catch((function(e){app.preloader.hide(),app.dialog.alert("Error while uploading image: "+e.message)}))}))}))}};$(document).on("click","a[href^=mailto],a[href^=tel],a[href^=sms],a[href^=skype],a[href^=facetime]",(function(e){if(1==app.device.webView&&1==app.device.ios){e.preventDefault();var t=e.target.getAttribute("href");return t&&(window.location=t),!1}})),$(document).on("click",".virtual-list .link",(function(e){e.stopPropagation(),e.stopImmediatePropagation()})),$(document).on("click","input[type='geo']",(function(e){e.preventDefault();var t=$("#"+e.target.id).data("pos");if(t){var i="https://www.google.com/maps/search/?api=1&query="+t.coords.latitude+","+t.coords.longitude;window.location=i}})),$(document).on("dragenter",".firebase_document_preview , .firebase_fileupload-dropzone ",(function(e){e.preventDefault(),$(this).css("opacity","0.5")})),$(document).on("dragover",".firebase_document_preview , .firebase_fileupload-dropzone",(function(e){return e.preventDefault(),$(this).css("opacity","0.5"),!1})),$(document).on("dragleave",".firebase_document_preview , .firebase_fileupload-dropzone ",(function(e){e.preventDefault(),$(this).css("opacity","1")})),$(document).on("click",".firebase_document_preview, .firebase_fileupload-dropzone",(function(e){(e.preventDefault(),app.tooltip.hide(".firebase_document_input"),1==thoriumCorePlugin.isLocal()&&(app.device.ios||app.device.android))&&app.tooltip.create({targetEl:this,text:"Drop your file here"}).show();$("#"+e.target.id+"-fileinput")})),$(document).on("click",".form-img-add-btn",(function(e){1==thoriumCorePlugin.isLocal()&&(app.device.ios||app.device.android)&&app.dialog.alert("Function not available in simulator, use drag&drop instead")})),$(document).on("click",".firebase_fileupload-rotate",(function(e){e.preventDefault();var t=$(this).attr("data-fileinput-ref"),i=$("#"+t),o=$("#"+t+"-fileinput");if(i&&o){var r=o.data("data-blob"),a=o.data("data-type");app.preloader.show(),setTimeout((function(){thoriumCorePlugin.rotateImage(r,a).then((function(e){app.preloader.hide(),i.css("background-image","url("+e+")"),o.data("data-blob",e)})).catch((function(e){app.preloader.hide(),app.dialog.alert("Error image: "+e.message)}))}),500)}})),$(document).on("drop",".firebase_document_preview , .firebase_fileupload-dropzone",(function(e){e.preventDefault(),$(this).css("opacity","1");var t=document.getElementById(e.target.id+"-fileinput");thoriumCorePlugin.uploadFileRead(e.dataTransfer.files[0],t),e.stopPropagation()})),$(document).on("change",".firebase_document_input",(function(e){e.preventDefault(),thoriumCorePlugin.uploadFileRead(e.target.files[0],e.target)})),$(document).on("click",".firebase_fileupload-remove",(function(e){e.preventDefault();var t=$(this),i=t.attr("data-fileinput-ref");$("#"+i)&&app.dialog.confirm("Remove file?",(function(){$("#"+i+"-fileinput").data("data-blob",null),$("#"+i+"-fileinput").data("data-type",null),$("#"+i).attr("data-clear",!0),$("#"+i+"-fileinput").data("data-filename",null),$("#"+i+"-fileinput-filename").css("visibility","hidden"),$("#"+i+"-fileinput-filename span").text(""),$("#"+i+"-fileinput-filename i").hide(),$("#"+i).css("background-image",""),$("#"+i+"-rotate")&&$("#"+i+"-rotate").hide(),$("#"+i+"-fileinput").attr("data-modified","true"),t.hide()}))})),$(document).on("mousedown","input[readonly]",(function(e){e.preventDefault()})),$(document).on("submit",".form",(function(e){thoriumCorePlugin.submitForm(e,$(this))})),$(document).on("click",".form-submit-button",(function(e){var t=$(this).attr("data-form")||"",i=$("#"+t);i&&i.length>0&&i.trigger("submit")})),$(document).on("click",".btncloseinfowindow",(function(e){e.preventDefault(),element=document.querySelector(".custominfowindow"),element&&(element.style.display="none")})),$(document).on("click",".webshare",(function(e){thoriumCorePlugin.webShare(e,$(this))})),$(document).on("click",".img-zoom",(function(e){if(1==this.classList.contains("dbexpress-image")&&"undefined"!=typeof dbExpressData){const e=this.closest(".dbexpress-virtual-list-content");if(e)return void dbExpressData.showVerticalRepeaterZoom(e,this)}thoriumCorePlugin.showImageZoom(e),e.stopPropagation(),e.stopImmediatePropagation()})),$(document).on("click",".collection-item-zoom",(function(e){thoriumCorePlugin.showCollectionZoom(this,e)})),$(document).on("click",".medialist-zoom",(function(e){thoriumCorePlugin.showMedialistZoom(this,e)})),$(document).on("click",".card-opened",(function(e){e.preventDefault,app.card.close($(this),!0)})),$(document).on("click",".dynamic-popover",(function(e){e.preventDefault,thoriumCorePlugin.showPopover(this)})),$(document).on("click",".popover li a",(function(e){null!=thoriumCorePlugin.currentPopover&&app.popover.close(thoriumCorePlugin.currentPopover.el,!0)})),$(document).on("click",".segmented .button",(function(e){$(this).closest(".segmented").children(".button-active").removeClass("button-active");$(this).addClass("button-active")})),$(document).on("mouseover","* [data-transform-trigger='mouseover']",(function(e){thoriumCorePlugin.applyEffect(this)})),$(document).on("mouseout","* [data-transform-trigger='mouseover']",(function(e){thoriumCorePlugin.resetEffect(this)})),$(document).on("click","* [data-transform-trigger='mouseclick']",(function(e){var t=$(this).attr("data-transform-effect")||"";this.style.transform=t})),document.addEventListener("scroll",(function(e){var t=e.target;thoriumCorePlugin.scrolleffectsHandler(t)}),!0),$(document).on("click","* [data-translate-language]",(function(e){var t=e.target.getAttribute("data-translate-language")||null,i=e.target.getAttribute("data-translate-direction")||null;1==kMultilingual&&thoriumCorePlugin.translate(t,i)})),app.on("offline",(function(){thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Internet connection lost")})),app.on("online",(function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Internet connection back")})),$(document).on("change",".capture_button input",(function(e){if(e.preventDefault(),e.target.files){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Media Capture in Progress...");const t=e.target.files[0],i=(URL.createObjectURL(t),this.getAttribute("accept"));if("image/*"==i){const i=new FileReader;i.addEventListener("load",(function(){const t=e.target.closest(".capture_button");app.emit("captureSuccess",t,i.result)}),!1),t&&i.readAsDataURL(t)}else if("video/*"==i){const i=new FileReader;i.onload=function(t){var i=t.target.result;const o=new Blob([new Uint8Array(i)],{type:"video/mp4"});var r=window.URL.createObjectURL(o);const a=e.target.closest(".capture_button");app.emit("captureSuccess",a,r)},t&&i.readAsArrayBuffer(t)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Capture Button Media Type not set")}})),$(document).on("click",".capture_button",(function(e){(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Capture Button Click event"),1==thoriumCorePlugin.isLocal()&&(app.device.ios||app.device.android))&&(app.tooltip.create({targetEl:this,text:"Function not available with the Simulator"}).show(),thoriumapi.logEvent(1,"[com.thoriumbuilder.core] Capture Buttons doesn't work in Simulator"))})),$(document).on("click",".container-link",(function(e,t){e.preventDefault,e.stopImmediatePropagation();var i=this.getAttribute("data-container-link"),o=this.getAttribute("data-container-link-type");if(i)if(2==o){this.getAttribute("data-container-target");if(window.open(i,"_blank"),0==app.device.capacitor)window.webkit&&0==app.device.cordova&&0==app.device.capacitor&&window.webkit.messageHandlers.thoriumHandler.postMessage(i);e.stopImmediatePropagation()}else if(1==o){var r=this.getAttribute("data-container-transition")||"";i=i.replace(".html",""),thoriumCorePlugin.loadpage(i,null,r)}else window.location.href=i})),$(document).on("click",".container-link a",(function(e,t){e.preventDefault,e.stopImmediatePropagation()})),$(document).on("tab:show",".tab",(function(e){if(app.emit("tabShow",this),"undefined"!=typeof openStreetMapPlugin)for(var t=this.querySelectorAll(".openstreetmap-api"),i=0;i<t.length;i++){var o=t[i],r=document.getElementById(o.id);r&&r.data&&(r.data.invalidateSize(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Refresh OSM Map with ID ["+o.id+"]"))}for(t=this.querySelectorAll(".virtual-list"),i=0;i<t.length;i++){o=t[i];var a=app.virtualList.get(o);if(a){const e=a.params.height,t=o.querySelector("li");if(t){const i=t.offsetHeight||0;i>0&&i!=e&&(a.params.height=i,a.update())}}}})),$(document).on("page:afterin",".page",(function(e,t){if("index"!=t.name&&"backward"!=t.direction&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" is loaded"),1!=app.device.cordova&&1!=app.device.capacitor||$(".webshare").hide(),1!=app.device.cordova&&1!=app.device.capacitor||1!=app.device.ios||($(".page-current .page-content").css("overflow-y","hidden"),setTimeout((function(){$(".page-current .page-content").css("overflow-y","auto")}),200)),thoriumCorePlugin.initEffects()),"index"==t.name){const e=document.querySelector(".page-content");e&&setTimeout((function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] back to Index"),e.style.overflowY="scroll",document.documentElement.style.overflowY="hidden",document.body.overflowY="hidden",app.preloader.hide()}),200)}})),$(document).on("page:beforeout",(function(e){var t=e.detail;if($(".custominfowindow").hide(),"backward"!=t.direction){thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" will close (beforeout)");for(var i=document.querySelectorAll(".audio"),o=0;o<i.length;o++){var r=i[o];r&&r.pause()}}})),$(document).on("page:beforein",(function(e){var t=e.detail;if("backward"!=t.direction){app.preloader.show(),thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" will open (beforein)"),$(".custominfowindow").hide(),1==kAutoClosePanels&&(app.panel.get("#panel-left").close(!0),app.panel.get("#panel-right").close(!0));for(var i=document.querySelectorAll(".audio"),o=0;o<i.length;o++){var r=i[o];r&&r.pause()}setTimeout((function(){app.preloader.hide()}),500)}})),$(window).on("resize",(function(e){thoriumCorePlugin.resize()})),$(document).on("page:mounted",(function(e){var t=e.detail;thoriumapi.logEvent(0,"[com.thoriumbuilder.core] Page "+t.name+" is mounted"),1==kMultilingual&&thoriumCorePlugin.translate(),1==kFillMode&&$(".navbar").css("background-color","var(--f7-theme-color)"),thoriumCorePlugin.initAllSwipers(),thoriumCorePlugin.initForms(),thoriumCorePlugin.initVirtualMediaLists(),thoriumCorePlugin.pullToRefreshHandle(e),thoriumCorePlugin.initAllTextEditors(),thoriumCorePlugin.initAllCalendars(),thoriumCorePlugin.initAllTimePickers(),thoriumCorePlugin.initAllAutoComplete(),thoriumCorePlugin.disableBounce()})),window.onerror=function(e,t,i,o){return thoriumapi.handleError(e,t,i,o),!1},document.addEventListener("deviceready",thoriumCorePlugin.initialize),document.addEventListener("DOMContentLoaded",thoriumCorePlugin.initialize);